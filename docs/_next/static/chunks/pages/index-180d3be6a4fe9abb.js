(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(t,e,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return i(9369)}])},9369:function(t,e,i){"use strict";i.r(e),i.d(e,{default:function(){return b}});var s=i(5893),h=i(844),o=i.n(h),n=i(7294);function r(t,e){return t+Math.random()*(e-t)}var a={randomItemFromArray:function(t){return t[Math.floor(r(0,t.length))]},randomNumberFromRange:r},d=i(724),u={getHeartX:function(t,e){return t*(16*Math.pow(Math.sin(e),3))},getHeartY:function(t,e){return-t*(13*Math.cos(e)-5*Math.cos(2*e)-2*Math.cos(3*e)-Math.cos(4*e))}},c={rgbaWithHexOpacity:function(t,e){let i=parseInt(t.slice(1,3),16),s=parseInt(t.slice(3,5),16),h=parseInt(t.slice(5,7),16);return"rgba("+i+", "+s+", "+h+", "+e+")"}};class l{update(t){if(this.deadTime-=t,this.deadTime<=0)this.dispose();else{let e=this.canvas.getContext("2d");e.beginPath(),d.Z.generate(50,t=>{let e=t/50*2*Math.PI,i=u.getHeartX(this.heartSize,e),s=u.getHeartY(this.heartSize,e);return{x:this.x+i,y:this.y+s}}).forEach((t,i)=>{0===i?e.moveTo(t.x,t.y):e.lineTo(t.x,t.y)}),e.closePath(),e.strokeStyle=c.rgbaWithHexOpacity("#FF4081",Math.max(this.deadTime/l.initialDeadTime,0)),e.stroke()}}dispose(){this.onDispose&&this.onDispose()}constructor(t,e,i){this.canvas=t,this.x=e,this.y=i,this.deadTime=l.initialDeadTime,this.heartSize=Math.min(this.canvas.height,this.canvas.height)/2e3}}l.initialDeadTime=800;var m=i(4422);class f{update(t){if(this.deadTime-=t,this.deadTime<=0)this.dispose();else{let e=this.canvas.getContext("2d");this.x+=this.xSpeed*t/1e3,this.y-=this.ySpeed*t/1e3,e.fillStyle=c.rgbaWithHexOpacity(this.color,this.deadTime%1),e.fillRect(this.x,this.y,1,1)}}dispose(){this.onDispose&&this.onDispose()}constructor(t,e,i,s,h=1e3){this.canvas=t,this.x=e,this.y=i,this.color=s,this.deadTime=h,this.xSpeed=a.randomNumberFromRange(f.minXSpeed,f.maxXSpeed),this.ySpeed=a.randomNumberFromRange(f.minYSpeed,f.maxYSpeed)}}f.minXSpeed=-8,f.maxXSpeed=8,f.minYSpeed=4,f.maxYSpeed=8;class x{get keepTime(){return this.deadTime-this.stopTime}get dead(){return this.deadTime<=0}update(t){let e=t/1e3;if(this.active||(this.stopTime-=e,this.deadTime-=e),this.nextFireLightCountdown-=t,this.nextFireLightCountdown<=0){let i=new f(this.canvas,a.randomNumberFromRange(this.x-x.fireLightGenerateRadius,this.x+x.fireLightGenerateRadius),a.randomNumberFromRange(this.y-x.fireLightGenerateRadius,this.y+x.fireLightGenerateRadius),this.color,200);i.onDispose=()=>{d.Z.remove(this.fireLights,i)},this.fireLights.push(i),this.nextFireLightCountdown=20}if(this.deadTime<=0)this.dispose();else{let s=Math.max(Math.min(this.deadTime/this.keepTime,1),.2);this.stopTime>0&&!this.active&&(this.x+=(this.xSpeed*e+this.xDeceleration*Math.pow(e,2)/2)*(this.destinationX>=this.x?1:-1),this.y+=(this.ySpeed*e+this.yDeceleration*Math.pow(e,2)/2)*(this.destinationY>=this.y?1:-1),this.xSpeed=Math.max(this.xSpeed+e*this.xDeceleration,0),this.ySpeed=Math.max(this.ySpeed+e*this.yDeceleration,0));let h=this.canvas.getContext("2d");h.beginPath(),h.arc(this.x,this.y,this.radius,0,2*Math.PI),h.fillStyle=c.rgbaWithHexOpacity(this.color,s),h.fill()}for(let o of this.fireLights)o.update(t)}dispose(){this.onDispose&&this.onDispose()}constructor(t,e,i,s,h,o){this.canvas=t,this.color=e,this.x=i,this.y=s,this.destinationX=h,this.destinationY=o,this.radius=1,this.stopTime=2,this.fireLights=[],this.nextFireLightCountdown=20,this.deadTime=4,this.active=!1,this.yDeceleration=-this.canvas.height/50,this.xDeceleration=-this.canvas.width/50,h===i?this.xSpeed=0:this.xSpeed=(Math.abs(h-i)-this.xDeceleration*Math.pow(this.stopTime,2)/2)/this.stopTime,o===s?this.ySpeed=0:this.ySpeed=(Math.abs(o-s)-this.yDeceleration*Math.pow(this.stopTime,2)/2)/this.stopTime}}x.fireLightGenerateRadius=5;class p{update(t){let e=this.canvas.getContext("2d");if(this.exploded){if(this.lightTime-=t,this.fireFlowers.some(t=>!t.dead)){if(this.lightTime>=0){let i=e.createRadialGradient(this.x,this.y,0,this.x,this.y,Math.max(Math.abs(this.x),Math.abs(this.y)));i.addColorStop(0,c.rgbaWithHexOpacity(this.color,this.lightTime/p.initialLightTime*.1)),i.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=i,e.globalCompositeOperation="lighter",e.fillRect(0,0,this.canvas.width,this.canvas.height),e.globalCompositeOperation="source-over"}}else this.onDispose&&this.onDispose()}else if(this.explodeCountdown<=0){if(this.exploded=!0,this.burstBuffer){let s=this.audioContext.createBufferSource();s.buffer=this.burstBuffer;let h=this.audioContext.createGain();h.gain.value=1,s.connect(h).connect(this.audioContext.destination),s.start(0)}this.getFireFlowerRelativePoints().forEach(t=>{let[e,i]=t,s=new x(this.canvas,this.color,this.x,this.y,this.x+e,this.y+i);s.onDispose=()=>{d.Z.remove(this.fireFlowers,s)},this.fireFlowers.push(s)})}else{if(this.explodeCountdown-=t,this.nextFireLightCountdown-=t,this.nextFireLightCountdown<=0){let o=new f(this.canvas,a.randomNumberFromRange(this.x-p.fireLightGenerateRadius,this.x+p.fireLightGenerateRadius),this.y,this.color);o.onDispose=()=>{d.Z.remove(this.fireLights,o)},this.fireLights.push(o)}e.beginPath(),this.ySpeed=this.ySpeed-this.yDeceleration*t/1e3,this.y=this.y-t/1e3*Math.max(this.ySpeed,0),e.arc(this.x,this.y,this.radius,0,2*Math.PI);let n=e.createRadialGradient(this.x,this.y,0,this.x,this.y,this.radius);n.addColorStop(0,this.color),n.addColorStop(1,c.rgbaWithHexOpacity(this.color,.2)),e.fillStyle=n,e.fill(),e.moveTo(this.x,this.y);let r=.2*this.ySpeed,u=this.y+r,l=e.createRadialGradient(this.x,this.y,0,this.x,this.y,Math.max(r,0));l.addColorStop(0,c.rgbaWithHexOpacity(this.color,a.randomNumberFromRange(.2,1))),l.addColorStop(1,"rgba(255,255,255,0)"),e.strokeStyle=l,e.lineWidth=1,e.lineTo(this.x,u),e.stroke()}for(let m of this.fireLights)m.update(t);for(let g of this.fireFlowers)g.update(t)}consumeTouchPath(t){if(this.fireFlowers.some(t=>t.stopTime<=0)){let e=this.canvas.getContext("2d");e.lineWidth=8;let i=new Path2D;for(let s of(i.moveTo(this.fireFlowers[0].x,this.fireFlowers[0].y),this.fireFlowers))i.lineTo(s.x,s.y);if(i.closePath(),t.filter(t=>e.isPointInStroke(i,t[0],t[1])).length>=t.length/3){for(let h of this.fireFlowers)h.active=!0;return e.closePath(),this.onActive&&this.onActive(),!0}e.closePath()}return!1}constructor(t,e,i,s=new AudioContext){if(this.canvas=t,this.burstBuffer=e,this.audioContext=s,this.radius=1,this.exploded=!1,this.nextFireLightCountdown=50,this.fireLights=[],this.fireFlowers=[],this.lightTime=p.initialLightTime,null!=i){let h=this.audioContext.createBufferSource();h.buffer=i;let o=this.audioContext.createGain();o.gain.value=1,h.connect(o).connect(this.audioContext.destination),h.start(0)}let n=.1*t.width;this.ySpeed=t.height/a.randomNumberFromRange(p.minYInitialSpeed,p.maxYInitialSpeed),this.yDeceleration=this.ySpeed/a.randomNumberFromRange(3,5),this.y=t.height,this.x=a.randomNumberFromRange(n,t.width-n),this.explodeCountdown=a.randomNumberFromRange(p.minExplodeCountdown,p.maxExplodeCountdown),this.color=a.randomItemFromArray(p.selectableColors)}}p.maxYInitialSpeed=4.5,p.minYInitialSpeed=3.5,p.maxYDeceleration=10,p.minYDeceleration=7,p.maxExplodeCountdown=4e3,p.minExplodeCountdown=3e3,p.fireLightGenerateRadius=3,p.selectableColors=["#FF5252","#FF4081","#E040FB","#7C4DFF","#536DFE","#448AFF","#40C4FF","#18FFFF","#64FFDA","#69F0AE","#B2FF59","#EEFF41","#FFFF00","#FFD740","#FFAB40"],p.initialLightTime=1e3;class g extends p{getFireFlowerRelativePoints(){let t=Math.min(this.canvas.height,this.canvas.width),e=Math.round(a.randomNumberFromRange(t/100,t/50)),i=10*e;return d.Z.generate(i,t=>{let s=t/i*2*Math.PI;return[u.getHeartX(e,s),u.getHeartY(e,s)]})}}function v(t,e,i,s){let[h,o]=e,[n,r]=i,[a,d]=s;return[(1-t)*(1-t)*h+2*t*(1-t)*n+t*t*a,(1-t)*(1-t)*o+2*t*(1-t)*r+t*t*d]}function y(t,e,i,s,h){let[o,n]=e,[r,a]=i,[d,u]=s,[c,l]=h;return[o*(1-t)*(1-t)*(1-t)+3*r*t*(1-t)*(1-t)+3*d*t*t*(1-t)+c*t*t*t,n*(1-t)*(1-t)*(1-t)+3*a*t*(1-t)*(1-t)+3*u*t*t*(1-t)+l*t*t*t]}function F(t,e){let[i,s]=t,[h,o]=e;return s===o?Math.abs(i-h):Math.sqrt(Math.pow(s-o,2)+Math.pow(i-h,2))}var T={getThreeOrderBezierLength:function(t,e,i,s){let h=d.Z.generate(101,t=>.01*t).map(h=>y(h,t,e,i,s)),o=0;for(let n=0;n<h.length-1;n++)o+=F(h[n],h[n+1]);return o},getTwoOrderBezierLength:function(t,e,i){let s=d.Z.generate(101,t=>.01*t).map(s=>v(s,t,e,i)),h=0;for(let o=0;o<s.length-1;o++)h+=F(s[o],s[o+1]);return h},getThreeOrderBezierPoint:y,getTwoOrderBezierPoint:v};class w extends p{getFireFlowerRelativePoints(){var t,e;let i;return(t=this.glyph,e=this.fontSize,(i=t.getPath(0,0,e)).commands.flatMap((t,e)=>{if("Z"===t.type)return[];if("M"==t.type)return[[t.x,t.y]];if("C"==t.type){let s=i.commands[e-1];if("Z"===s.type)return[];{let h=s.x,o=s.y,n=T.getThreeOrderBezierLength([h,o],[t.x1,t.y1],[t.x2,t.y2],[t.x,t.y]);return d.Z.generate(Math.ceil(n/5),e=>T.getThreeOrderBezierPoint(e/n*5,[h,o],[t.x1,t.y1],[t.x2,t.y2],[t.x,t.y]))}}if("Q"==t.type){let r=i.commands[e-1];if("Z"===r.type)return[];{let a=r.x,u=r.y,c=T.getTwoOrderBezierLength([a,u],[t.x1,t.y1],[t.x,t.y]);return d.Z.generate(Math.ceil(c/5),e=>T.getTwoOrderBezierPoint(e/c*5,[a,u],[t.x1,t.y1],[t.x,t.y]))}}{if("L"!=t.type)return[];let l=i.commands[e-1];if("Z"===l.type)return[];{let m=l.x,f=l.y,x=t.x,p=t.y,g=t=>(t-m)*(f-p)/(m-x)+f,v=Math.abs(m-x);return d.Z.generate(Math.ceil(v/5),t=>{let e=t/v*5,i=g(e);return[e,i]})}}}).filter(t=>2==t.length).map(t=>t)).map(t=>{let[e,i]=t;return[e+this.xOffset,i+this.yOffset]})}constructor(t,e,i,s,h,o,n,r=new AudioContext){super(h,o,n,r),this.glyph=t,this.fontSize=s,this.yOffset=0,this.xOffset=0,this.xOffset=-e.width/2,this.yOffset=(e.actualBoundingBoxAscent+e.actualBoundingBoxDescent)/2,this.yDeceleration=0,this.explodeCountdown=p.minExplodeCountdown,this.x=i}}class C{get quickFire(){return this.activeFireworkCountdown<=0}addTouchLove(t,e){this.touchPoints.push([t,e]);let i=new l(this.canvas,t,e);i.onDispose=()=>{d.Z.remove(this.touchLoves,i)},this.touchLoves.push(i)}computeNextFireTime(){this.nextFireTime+=a.randomNumberFromRange(400,1200)}computeNextQuickFireTime(){this.nextFireTime+=a.randomNumberFromRange(100,200)}fire(){let t=new g(this.canvas,this.burstBuffer,this.fireBuffer,this.audioContext);t.onDispose=()=>{d.Z.remove(this.fireworks,t)},t.onActive=()=>{this.activeFireworkCountdown-=1},this.fireworks.push(t)}update(t){let e=this.canvas.getContext("2d"),i=-1===this.prevTime?0:t-this.prevTime;if(this.quickFire&&(this.quickFireTime-=i),this.quickFireTime<=0&&(this.fireworks.forEach(t=>{t.fireFlowers.forEach(t=>{t.active=!1})}),this.quickFireTime+C.textShowDelay<=0&&this.texts.length>=0)){if(this.nextTextIndexTime<=0){this.nextTextIndexTime=C.initialNextTextIndexTime,this.currentTextIndex+=1;let s=this.canvas.width,h=s/6;e.font="".concat(h,"px hwxk");let o=this.texts[this.currentTextIndex],n=s/24;if(o&&null!=this.font){let r=Array.from(o),u=r.map(t=>e.measureText(t)),c=t=>t.width,l=(o.length-1)*n+d.Z.sum(u.map(t=>c(t))),m=(s-l)/2;for(let f=0;f<o.length;f++){var x;let p=null===(x=this.font)||void 0===x?void 0:x.charToGlyph(o.charAt(f));if(p){let g=new w(p,u[f],m,h,this.canvas,this.burstBuffer,this.fireBuffer,this.audioContext);g.onDispose=()=>{d.Z.remove(this.fireworks,g)},this.fireworks.push(g),m+=n+c(u[f])}}}}else this.nextTextIndexTime-=i}this.nextFireTime<=t&&(this.quickFire&&this.quickFireTime>=0?(d.Z.generate(Math.round(a.randomNumberFromRange(1,3)),()=>{this.fire()}),this.computeNextQuickFireTime()):(this.fire(),this.computeNextFireTime())),e.fillStyle="black",e.fillRect(0,0,this.canvas.width,this.canvas.height),this.fireworks.forEach(t=>{t.update(i)}),this.touchLoves.forEach(t=>{t.update(i)}),this.prevTime=t,this.requestNextFrame()}requestNextFrame(){this.requestAnimationFrameNumber=window.requestAnimationFrame(t=>this.update(t))}dispose(){this.canvas.removeEventListener("mousedown",this.onTouchstart),this.canvas.removeEventListener("mouseup",this.onTouchend),this.canvas.removeEventListener("mousemove",this.onMousemove),this.canvas.removeEventListener("touchstart",this.onTouchstart),this.canvas.removeEventListener("touchend",this.onTouchend),this.canvas.removeEventListener("touchend",this.onTouchmove),this.requestAnimationFrameNumber&&window.cancelAnimationFrame(this.requestAnimationFrameNumber)}constructor(t){this.canvas=t,this.prevTime=-1,this.nextFireTime=2e3,this.fireworks=[],this.touched=!1,this.touchPoints=[],this.audioContext=new AudioContext,this.touchLoves=[],this.activeFireworkCountdown=5,this.texts=["2023","新年快乐","大展宏兔"],this.currentTextIndex=-1,this.nextTextIndexTime=0,this.quickFireTime=1e4,this.onTouchstart=()=>{this.touched=!0,this.touchPoints=[]},this.onMousemove=t=>{t.preventDefault(),this.touched&&this.addTouchLove(t.x,t.y)},this.onTouchend=()=>{for(let t of(this.touched=!1,this.fireworks))if(t.consumeTouchPath(this.touchPoints))break},this.onTouchmove=t=>{t.preventDefault();let e=t.touches.item(0);e&&this.addTouchLove(e.clientX,e.clientY)},this.canvas.addEventListener("mousedown",this.onTouchstart),this.canvas.addEventListener("mouseup",this.onTouchend),this.canvas.addEventListener("mousemove",this.onMousemove),this.canvas.addEventListener("touchstart",this.onTouchstart),this.canvas.addEventListener("touchend",this.onTouchend),this.canvas.addEventListener("touchmove",this.onTouchmove),Promise.all([fetch("".concat("/firework-love-nextjs","/audio/burst.mp3")).then(t=>t.arrayBuffer()).then(t=>this.audioContext.decodeAudioData(t)).then(t=>{this.burstBuffer=t}),fetch("".concat("/firework-love-nextjs","/audio/fire.mp3")).then(t=>t.arrayBuffer()).then(t=>this.audioContext.decodeAudioData(t)).then(t=>this.fireBuffer=t),new Promise((t,e)=>{m.ZP.load("".concat("/firework-love-nextjs","/fonts/华文楷体.ttf"),(i,s)=>{i?e(i):t(s)})}).then(t=>this.font=t)]).then(()=>{this.onLoad&&this.onLoad(),this.requestNextFrame()})}}function b(){(0,n.useEffect)(()=>{console.log("useEffect");let e=t.current;e.width=document.body.getBoundingClientRect().width,e.height=document.body.getBoundingClientRect().height;let i=e.getContext("2d");i.fillStyle="black",i.fillRect(0,0,e.width,e.height);let s=new C(e);return()=>{s.dispose()}},[]);let t=(0,n.useRef)(null);return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("canvas",{className:o().canvas,ref:t})})}C.initialNextTextIndexTime=6e3,C.textShowDelay=4e3},844:function(){},6102:function(){}},function(t){t.O(0,[257,144,774,888,179],function(){return t(t.s=8312)}),_N_E=t.O()}]);