(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{724:function(t,e){"use strict";function i(t,e){let i=t.indexOf(e);return -1!==i&&(t.splice(i,1),!0)}let s=t=>t;function h(t){return"number"==typeof t?t:0}e.Z={sum:function(t,e=h){let i=0;return t.forEach(t=>{i+=e(t)}),i},remove:i,removeBy:function(t,e){let s=t.find(e);return i(t,s)},intersectionOf:function(t,e){return t.filter(t=>e.includes(t))},groupBy:function(t,e,i){let s=new Map;return t.forEach((t,h,o)=>{let n=e(t),r=i&&i(t,h);s.has(n)?s.set(n,s.get(n).concat([r])):s.set(n,[r])}),s},sortComposition:function(t,e){return e.length?t.sort((t,i)=>{for(let s of e){let h=s(t,i);if(0!==h)return h}return 0}):t.sort()},toMap:function(t,e,i){return new Map(t.map((t,s)=>[e(t,s),(i||(t=>t))(t,s)]))},repeat:function(t,e){let i=[];for(let s=0;s<e;s++)i.push(t);return i},generate:function(t,e){return Array.from(Array(t).keys()).map(e)},findMaxItem:function(t,e=s){return t.reduce((t,i)=>e(t)>e(i)?t:i)},findMinItem:function(t,e=s){return t.reduce((t,i)=>e(t)<e(i)?t:i)},exchange:function(t,e,i){let s=t[e];t[e]=t[i],t[i]=s}}},8312:function(t,e,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return i(4130)}])},4130:function(t,e,i){"use strict";i.r(e),i.d(e,{default:function(){return g}});var s=i(5893),h=i(844),o=i.n(h),n=i(7294);function r(t,e){return t+Math.random()*(e-t)}var a={randomItemFromArray:function(t){return t[Math.floor(r(0,t.length))]},randomNumberFromRange:r},u={rgbaWithHexOpacity:function(t,e){let i=parseInt(t.slice(1,3),16),s=parseInt(t.slice(3,5),16),h=parseInt(t.slice(5,7),16);return"rgba("+i+", "+s+", "+h+", "+e+")"}};class d{update(t){if(this.deadTime-=t,this.deadTime<=0)this.dispose();else{let e=this.canvas.getContext("2d");this.x+=this.xSpeed*t/1e3,this.y-=this.ySpeed*t/1e3,e.fillStyle=u.rgbaWithHexOpacity(this.color,this.deadTime%1),e.fillRect(this.x,this.y,1,1)}}dispose(){this.onDispose&&this.onDispose()}constructor(t,e,i,s,h=1e3){this.canvas=t,this.x=e,this.y=i,this.color=s,this.deadTime=h,this.xSpeed=a.randomNumberFromRange(d.minXSpeed,d.maxXSpeed),this.ySpeed=a.randomNumberFromRange(d.minYSpeed,d.maxYSpeed)}}d.minXSpeed=-8,d.maxXSpeed=8,d.minYSpeed=4,d.maxYSpeed=8;var c=i(724);class l{get keepTime(){return this.deadTime-this.stopTime}update(t){let e=t/1e3;if(this.active||(this.stopTime-=e,this.deadTime-=e),this.nextFireLightCountdown-=t,this.nextFireLightCountdown<=0){let i=new d(this.canvas,a.randomNumberFromRange(this.x-l.fireLightGenerateRadius,this.x+l.fireLightGenerateRadius),a.randomNumberFromRange(this.y-l.fireLightGenerateRadius,this.y+l.fireLightGenerateRadius),this.color,200);i.onDispose=()=>{c.Z.remove(this.fireLights,i)},this.fireLights.push(i),this.nextFireLightCountdown=20}if(this.deadTime<=0)this.dispose();else{let s=Math.max(Math.min(this.deadTime/this.keepTime,1),.2);this.stopTime>0&&!this.active&&(this.x+=(this.xSpeed*e+this.xDeceleration*Math.pow(e,2)/2)*(this.destinationX>=this.x?1:-1),this.y+=(this.ySpeed*e+this.yDeceleration*Math.pow(e,2)/2)*(this.destinationY>=this.y?1:-1),this.xSpeed=Math.max(this.xSpeed+e*this.xDeceleration,0),this.ySpeed=Math.max(this.ySpeed+e*this.yDeceleration,0));let h=this.canvas.getContext("2d");h.beginPath(),h.arc(this.x,this.y,this.radius,0,2*Math.PI),h.fillStyle=u.rgbaWithHexOpacity(this.color,s),h.fill()}for(let o of this.fireLights)o.update(t)}dispose(){this.onDispose&&this.onDispose()}constructor(t,e,i,s,h,o){this.canvas=t,this.color=e,this.x=i,this.y=s,this.destinationX=h,this.destinationY=o,this.radius=1,this.stopTime=2,this.fireLights=[],this.nextFireLightCountdown=20,this.deadTime=4,this.active=!1,this.yDeceleration=-this.canvas.height/50,this.xDeceleration=-this.canvas.width/50,h===i?this.xSpeed=0:this.xSpeed=(Math.abs(h-i)-this.xDeceleration*Math.pow(this.stopTime,2)/2)/this.stopTime,o===s?this.ySpeed=0:this.ySpeed=(Math.abs(o-s)-this.yDeceleration*Math.pow(this.stopTime,2)/2)/this.stopTime}}l.fireLightGenerateRadius=5;var m={getHeartX:function(t,e){return t*(16*Math.pow(Math.sin(e),3))},getHeartY:function(t,e){return-t*(13*Math.cos(e)-5*Math.cos(2*e)-2*Math.cos(3*e)-Math.cos(4*e))}};class f{update(t){let e=this.canvas.getContext("2d");if(this.exploded){if(this.lightTime-=t,this.lightTime>=0){let i=e.createRadialGradient(this.x,this.y,0,this.x,this.y,Math.max(Math.abs(this.x),Math.abs(this.y)));i.addColorStop(0,u.rgbaWithHexOpacity(this.color,this.lightTime/f.initialLightTime*.1)),i.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=i,e.globalCompositeOperation="lighter",e.fillRect(0,0,this.canvas.width,this.canvas.height),e.globalCompositeOperation="source-over"}}else if(this.explodeCountdown<=0){if(this.exploded=!0,this.burstBuffer){let s=this.audioContext.createBufferSource();s.buffer=this.burstBuffer;let h=this.audioContext.createGain();h.gain.value=1,s.connect(h).connect(this.audioContext.destination),s.start(0)}let o=Math.min(this.canvas.height,this.canvas.width),n=Math.round(a.randomNumberFromRange(o/100,o/50)),r=10*n;c.Z.generate(r,t=>{let e=t/r*2*Math.PI,i=new l(this.canvas,this.color,this.x,this.y,this.x+m.getHeartX(n,e),this.y+m.getHeartY(n,e));i.onDispose=()=>{c.Z.remove(this.fireFlowers,i)},this.fireFlowers.push(i)})}else{if(this.explodeCountdown-=t,this.nextFireLightCountdown-=t,this.nextFireLightCountdown<=0){let p=new d(this.canvas,a.randomNumberFromRange(this.x-f.fireLightGenerateRadius,this.x+f.fireLightGenerateRadius),this.y,this.color);p.onDispose=()=>{c.Z.remove(this.fireLights,p)},this.fireLights.push(p)}e.beginPath(),this.ySpeed=this.ySpeed-this.yDeceleration*t/1e3,this.y=this.y-t/1e3*Math.max(this.ySpeed,0),e.arc(this.x,this.y,this.radius,0,2*Math.PI);let x=e.createRadialGradient(this.x,this.y,0,this.x,this.y,this.radius);x.addColorStop(0,this.color),x.addColorStop(1,u.rgbaWithHexOpacity(this.color,.2)),e.fillStyle=x,e.fill(),e.moveTo(this.x,this.y);let g=.2*this.ySpeed,F=this.y+g,v=e.createRadialGradient(this.x,this.y,0,this.x,this.y,Math.max(g,0));v.addColorStop(0,u.rgbaWithHexOpacity(this.color,a.randomNumberFromRange(.2,1))),v.addColorStop(1,"rgba(255,255,255,0)"),e.strokeStyle=v,e.lineWidth=1,e.lineTo(this.x,F),e.stroke()}for(let y of this.fireLights)y.update(t);for(let w of this.fireFlowers)w.update(t)}consumeTouchPath(t){if(this.fireFlowers.some(t=>t.stopTime<=0)){let e=this.canvas.getContext("2d");e.lineWidth=8;let i=new Path2D;for(let s of(i.moveTo(this.fireFlowers[0].x,this.fireFlowers[0].y),this.fireFlowers))i.lineTo(s.x,s.y);if(i.closePath(),t.filter(t=>e.isPointInStroke(i,t[0],t[1])).length>=t.length/3){for(let h of this.fireFlowers)h.active=!0;return e.closePath(),this.onActive&&this.onActive(),!0}e.closePath()}return!1}constructor(t,e,i,s=new AudioContext){if(this.canvas=t,this.burstBuffer=e,this.audioContext=s,this.radius=1,this.exploded=!1,this.nextFireLightCountdown=50,this.fireLights=[],this.fireFlowers=[],this.lightTime=f.initialLightTime,null!=i){let h=this.audioContext.createBufferSource();h.buffer=i;let o=this.audioContext.createGain();o.gain.value=1,h.connect(o).connect(this.audioContext.destination),h.start(0)}let n=.1*t.width;this.ySpeed=t.height/a.randomNumberFromRange(f.minYInitialSpeed,f.maxYInitialSpeed),this.yDeceleration=this.ySpeed/a.randomNumberFromRange(3,5),this.y=t.height,this.x=a.randomNumberFromRange(n,t.width-n),this.explodeCountdown=a.randomNumberFromRange(f.minExplodeCountdown,f.maxExplodeCountdown),this.color=a.randomItemFromArray(f.selectableColors)}}f.maxYInitialSpeed=4.5,f.minYInitialSpeed=3.5,f.maxYDeceleration=10,f.minYDeceleration=7,f.maxExplodeCountdown=4e3,f.minExplodeCountdown=3e3,f.fireLightGenerateRadius=3,f.selectableColors=["#FF5252","#FF4081","#E040FB","#7C4DFF","#536DFE","#448AFF","#40C4FF","#18FFFF","#64FFDA","#69F0AE","#B2FF59","#EEFF41","#FFFF00","#FFD740","#FFAB40"],f.initialLightTime=1e3;class p{update(t){if(this.deadTime-=t,this.deadTime<=0)this.dispose();else{let e=this.canvas.getContext("2d");e.beginPath(),c.Z.generate(50,t=>{let e=t/50*2*Math.PI,i=m.getHeartX(this.heartSize,e),s=m.getHeartY(this.heartSize,e);return{x:this.x+i,y:this.y+s}}).forEach((t,i)=>{0===i?e.moveTo(t.x,t.y):e.lineTo(t.x,t.y)}),e.closePath(),e.strokeStyle=u.rgbaWithHexOpacity("#FF4081",Math.max(this.deadTime/p.initialDeadTime,0)),e.stroke()}}dispose(){this.onDispose&&this.onDispose()}constructor(t,e,i){this.canvas=t,this.x=e,this.y=i,this.deadTime=p.initialDeadTime,this.heartSize=Math.min(this.canvas.height,this.canvas.height)/2e3}}p.initialDeadTime=800;class x{get quickFire(){return this.activeFireworkCountdown<=0}computeNextFireTime(){this.nextFireTime+=a.randomNumberFromRange(400,1200)}computeNextQuickFireTime(){this.nextFireTime+=a.randomNumberFromRange(100,200)}fire(){let t=new f(this.canvas,this.burstBuffer,this.fireBuffer,this.audioContext);t.onActive=()=>{this.activeFireworkCountdown-=1},this.fireworks.push(t)}update(t){let e=-1===this.prevTime?0:t-this.prevTime;this.quickFire&&(this.quickFireTime-=e),this.nextFireTime<=t&&(this.quickFire&&this.quickFireTime>=0?(c.Z.generate(Math.round(a.randomNumberFromRange(1,3)),t=>{this.fire()}),this.computeNextQuickFireTime()):(this.fire(),this.computeNextFireTime()));let i=this.canvas.getContext("2d");i.fillStyle="black",i.fillRect(0,0,this.canvas.width,this.canvas.height),this.fireworks.forEach(t=>{t.update(e)}),this.touchLoves.forEach(t=>{t.update(e)}),this.prevTime=t,this.requestNextFrame()}requestNextFrame(){this.requestAnimationFrameNumber=window.requestAnimationFrame(t=>this.update(t))}dispose(){this.canvas.removeEventListener("touchstart",this.onTouchstart),this.canvas.removeEventListener("touchend",this.onTouchend),this.canvas.removeEventListener("touchend",this.onTouchmove),this.requestAnimationFrameNumber&&window.cancelAnimationFrame(this.requestAnimationFrameNumber)}constructor(t){this.canvas=t,this.prevTime=-1,this.nextFireTime=2e3,this.explosionTime=2e3,this.fireworks=[],this.touched=!1,this.touchPoints=[],this.audioContext=new AudioContext,this.touchLoves=[],this.activeFireworkCountdown=5,this.quickFireTime=1e4,this.onTouchstart=()=>{this.touched=!0,this.touchPoints=[]},this.onTouchend=()=>{for(let t of(this.touched=!1,this.fireworks))if(t.consumeTouchPath(this.touchPoints))break},this.onTouchmove=t=>{t.preventDefault();let e=t.touches.item(0);if(e){let i=e.clientX,s=e.clientY;this.touchPoints.push([i,s]);let h=new p(this.canvas,i,s);h.onDispose=()=>{c.Z.remove(this.touchLoves,h)},this.touchLoves.push(h)}},this.requestNextFrame(),this.canvas.addEventListener("touchstart",this.onTouchstart),this.canvas.addEventListener("touchend",this.onTouchend),this.canvas.addEventListener("touchmove",this.onTouchmove),Promise.all([fetch("".concat("/firework-love-nextjs","/audio/burst.mp3")).then(t=>t.arrayBuffer()).then(t=>this.audioContext.decodeAudioData(t)).then(t=>{this.burstBuffer=t}),fetch("".concat("/firework-love-nextjs","/audio/fire.mp3")).then(t=>t.arrayBuffer()).then(t=>this.audioContext.decodeAudioData(t)).then(t=>this.fireBuffer=t)]).then(()=>{this.onLoad&&this.onLoad()})}}function g(){(0,n.useEffect)(()=>{console.log("useEffect");let e=t.current;e.width=document.body.getBoundingClientRect().width,e.height=document.body.getBoundingClientRect().height;let i=e.getContext("2d");i.fillStyle="black",i.fillRect(0,0,e.width,e.height);let s=new x(e);return()=>{s.dispose()}},[]);let t=(0,n.useRef)(null);return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("canvas",{className:o().canvas,ref:t})})}},844:function(){}},function(t){t.O(0,[774,888,179],function(){return t(t.s=8312)}),_N_E=t.O()}]);